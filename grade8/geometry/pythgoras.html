<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <script>
    // --- 专转 ---
    const SESSION_KEY = 'access_grade8';
    const LOGIN_PAGE = '../index8.html';
    const TIMEOUT_MINUTES = 15;

    // 1. 拽转 住 ( 拽砖专 砖专)
    if (sessionStorage.getItem(SESSION_KEY) !== 'true') {
        window.location.href = LOGIN_PAGE;
        throw new Error("Access Denied");
    }

    // 2.  转拽  (15 拽转)
    let inactivityTimer;
    function resetTimer() {
        clearTimeout(inactivityTimer);
        inactivityTimer = setTimeout(() => {
            sessionStorage.removeItem(SESSION_KEY); // 拽转 砖专
            window.location.href = LOGIN_PAGE; // 注驻 祝 转
        }, TIMEOUT_MINUTES * 60 * 1000);
    }
    
    // 驻住 专  驻注 砖 砖转砖
    window.onload = resetTimer;
    document.onmousemove = resetTimer;
    document.onkeypress = resetTimer;
    document.onclick = resetTimer;
    document.ontouchstart = resetTimer; // 驻

    // 3. 住转 F12 拽砖 
    document.addEventListener('contextmenu', event => event.preventDefault());
    document.addEventListener('keydown', event => {
        if (event.key === 'F12' || 
            (event.ctrlKey && event.shiftKey && (event.key === 'I' || event.key === 'J' || event.key === 'C')) || 
            (event.ctrlKey && event.key === 'u')) {
            event.preventDefault();
        }
    });
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>砖驻 驻转专住 - 专</title>
    
    <!-- 注转 住驻专转 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;700;900&display=swap');
        body { font-family: 'Rubik', sans-serif; background-color: #f0fdf4; overscroll-behavior: none; }
        
        .ltr-override { direction: ltr; unicode-bidi: embed; }
        
        /* 住 住专 */
        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px; width: 20px;
            border-radius: 50%;
            background: #16a34a;
            margin-top: -8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 4px;
            background: #bbf7d0;
            border-radius: 2px;
        }
        
        /* 爪 注 驻注转 拽住 */
        .fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body class="h-screen flex flex-col text-slate-800 overflow-hidden">

    <div id="root" class="h-full flex flex-col"></div>

    <script type="text/babel" data-presets="env,react">
        const { useState, useEffect, useRef } = React;

        // --- 拽 (SVG) ---
        const Icon = ({ d, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{d}</svg>
        );
        const TriangleIcon = () => <Icon d={<path d="M3 20h18L12 4z" />} className="w-5 h-5" />;
        const CalculatorIcon = () => <Icon d={<><path d="M14 3v4a1 1 0 0 0 1 1h4"/><path d="M5 21h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2z"/><line x1="8" y1="14" x2="16" y2="14"/><line x1="8" y1="18" x2="16" y2="18"/></>} className="w-5 h-5" />;
        const CheckIcon = () => <Icon d={<polyline points="20 6 9 17 4 12"/>} className="w-5 h-5" />;
        const RefreshIcon = () => <Icon d={<><path d="M23 4v6h-6"/><path d="M1 20v-6h6"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></>} className="w-5 h-5" />;
        const InfoIcon = () => <Icon d={<><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></>} className="w-5 h-5" />;

        // --- 专 注专 砖转 ---
        const MathEq = ({ children }) => <span className="font-mono font-bold ltr-override text-lg">{children}</span>;

        // --- 砖转 拽专 (Explore) ---
        const ExploreTab = () => {
            const [a, setA] = useState(3);
            const [b, setB] = useState(4);
            const [showSquares, setShowSquares] = useState(true);

            // 砖 转专
            const c = Math.sqrt(a*a + b*b);

            // 拽  爪专
            const scale = 35;
            const offsetX = 180; // 专 X 砖注专 拽住
            const offsetY = 280; // 专 Y 砖注专

            // 拽专转 砖砖 (转 砖专 -C)
            // C = (0,0) 拽转 (住转 驻住)
            // A = (0, -a)  砖-Y 驻 -SVG
            // B = (b, 0)
            
            const pC = { x: offsetX, y: offsetY };
            const pA = { x: offsetX, y: offsetY - a * scale };
            const pB = { x: offsetX + b * scale, y: offsetY };

            // 砖 转 转专  砖专 转 专注 专拽
            // 转  砖驻注 砖 拽 -A -B
            const dx = pB.x - pA.x;
            const dy = pB.y - pA.y;
            const rotationAngle = Math.atan2(dy, dx) * (180 / Math.PI);

            return (
                <div className="flex flex-col lg:flex-row h-full overflow-hidden">
                    
                    {/* 专 爪专 */}
                    <div className="flex-grow bg-white relative overflow-hidden flex justify-center items-center p-4">
                        <svg width="100%" height="100%" viewBox="0 0 500 500" className="max-w-[600px] max-h-[600px]">
                            <defs>
                                <pattern id="grid" width="20" height="20" patternUnits="userSpaceOnUse">
                                    <path d="M 20 0 L 0 0 0 20" fill="none" stroke="#f0fdf4" strokeWidth="1"/>
                                </pattern>
                            </defs>
                            <rect width="100%" height="100%" fill="url(#grid)" />

                            {/* 专注 (Squares) */}
                            {showSquares && (
                                <g>
                                    {/* 专注 注 爪注 a () */}
                                    <g>
                                        <rect x={pA.x - a*scale} y={pA.y} width={a*scale} height={a*scale} fill="rgba(239, 68, 68, 0.15)" stroke="#ef4444" strokeWidth="2" />
                                        <text x={pA.x - a*scale/2} y={pA.y + a*scale/2} textAnchor="middle" dominantBaseline="middle" className="text-sm font-bold fill-red-700 ltr-override fade-in">
                                            {a}虏 = {a*a}
                                        </text>
                                    </g>
                                    
                                    {/* 专注 注 爪注 b () */}
                                    <g>
                                        <rect x={pC.x} y={pC.y} width={b*scale} height={b*scale} fill="rgba(59, 130, 246, 0.15)" stroke="#3b82f6" strokeWidth="2" />
                                        <text x={pC.x + b*scale/2} y={pC.y + b*scale/2} textAnchor="middle" dominantBaseline="middle" className="text-sm font-bold fill-blue-700 ltr-override fade-in">
                                            {b}虏 = {b*b}
                                        </text>
                                    </g>
                                    
                                    {/* 专注 注 转专 c (专拽) */}
                                    <g transform={`translate(${pA.x}, ${pA.y}) rotate(${rotationAngle})`}>
                                        {/* 专注  "注" (negative Y) 住转 拽 住转 */}
                                        <rect x="0" y={-c*scale} width={c*scale} height={c*scale} fill="rgba(34, 197, 94, 0.15)" stroke="#22c55e" strokeWidth="2" />
                                        {/* 拽住 转 专注 住 - 爪专 住 专  砖 拽专?  砖专 砖专 转 住? 注祝 砖专. */}
                                        <g transform={`translate(${c*scale/2}, ${-c*scale/2}) rotate(${-rotationAngle})`}>
                                            <text x="0" y="0" textAnchor="middle" dominantBaseline="middle" className="text-sm font-bold fill-green-700 ltr-override fade-in">
                                                c虏 = {c%1===0 ? c*c : (c*c).toFixed(1)}
                                            </text>
                                        </g>
                                    </g>
                                </g>
                            )}

                            {/* 砖砖 注爪 (注 专注) */}
                            <path d={`M ${pC.x} ${pC.y} L ${pA.x} ${pA.y} L ${pB.x} ${pB.y} Z`} fill="rgba(255,255,255,0.9)" stroke="#374151" strokeWidth="3" />
                            
                            {/* 住 转 砖专 */}
                            <path d={`M ${pC.x} ${pC.y-15} L ${pC.x+15} ${pC.y-15} L ${pC.x+15} ${pC.y}`} fill="none" stroke="#374151" strokeWidth="2" />
                            <circle cx={pC.x+6} cy={pC.y-6} r="1" fill="#374151" />

                            {/* 转转 专 爪注转 */}
                            <text x={pC.x - 15} y={(pC.y + pA.y)/2} className="text-sm font-bold fill-red-600" textAnchor="middle">a={a}</text>
                            <text x={(pC.x + pB.x)/2} y={pC.y + 20} className="text-sm font-bold fill-blue-600" textAnchor="middle">b={b}</text>
                            {/* 转转 c 拽爪转 转专 转转 爪注 转专 */}
                            <g transform={`translate(${(pA.x + pB.x)/2}, ${(pA.y + pB.y)/2})`}>
                                <rect x="-22" y="-12" width="44" height="24" rx="4" fill="rgba(255,255,255,0.9)" />
                                <text x="0" y="5" className="text-sm font-bold fill-green-600" textAnchor="middle">c={c%1===0 ? c : c.toFixed(2)}</text>
                            </g>

                        </svg>

                        <div className="absolute bottom-4 right-4 flex gap-2">
                            <button 
                                onClick={() => setShowSquares(!showSquares)}
                                className={`px-3 py-1 text-xs rounded-full border shadow-sm transition-all ${showSquares ? 'bg-green-100 border-green-300 text-green-800' : 'bg-white border-gray-300 text-gray-500'}`}
                            >
                                {showSquares ? '住转专 砖' : '爪 砖'}
                            </button>
                        </div>
                    </div>

                    {/* 驻 砖 住专 */}
                    <div className="w-full lg:w-96 bg-white border-t lg:border-t-0 lg:border-r border-green-100 p-6 flex flex-col shadow-xl z-10 overflow-y-auto">
                        <div className="mb-6">
                            <h2 className="text-2xl font-bold text-slate-800 mb-2 text-center">住 砖注转</h2>
                            
                            <div className="bg-slate-50 p-4 rounded-xl border border-slate-200 shadow-inner mb-4 text-center">
                                <div className="text-3xl ltr-override text-slate-700 font-black tracking-wider">
                                    <span className="text-red-500">a虏</span> + <span className="text-blue-500">b虏</span> = <span className="text-green-600">c虏</span>
                                </div>
                            </div>

                            <div className="bg-yellow-50 p-3 rounded-lg border border-yellow-200 text-sm text-slate-700 flex gap-2">
                                <InfoIcon className="shrink-0 text-yellow-600 mt-0.5" />
                                <div>
                                    <strong> 专注?</strong>  <span className="font-mono font-bold" dir="ltr">a虏</span>  拽  砖 砖 砖 专注 砖专 爪注 砖  <span className="font-mono font-bold">a</span>.
                                    <br/>
                                    砖驻 专: 住 砖   砖 拽 砖 专拽!
                                </div>
                            </div>
                        </div>

                        <div className="space-y-6 flex-grow">
                            <div>
                                <label className="flex justify-between font-bold text-slate-700 mb-2">
                                    <span className="text-red-500">专 爪 a</span>
                                    <span className="bg-red-50 text-red-700 px-2 rounded">{a}</span>
                                </label>
                                <input type="range" min="1" max="8" step="1" value={a} onChange={(e) => setA(Number(e.target.value))} className="accent-red-500" />
                            </div>
                            <div>
                                <label className="flex justify-between font-bold text-slate-700 mb-2">
                                    <span className="text-blue-500">专 爪 b</span>
                                    <span className="bg-blue-50 text-blue-700 px-2 rounded">{b}</span>
                                </label>
                                <input type="range" min="1" max="8" step="1" value={b} onChange={(e) => setB(Number(e.target.value))} className="accent-blue-500" />
                            </div>

                            <div className="mt-4 bg-green-50 p-4 rounded-xl border border-green-200">
                                <h3 className="font-bold text-green-800 mb-2 border-b border-green-200 pb-1 text-center">砖 驻注</h3>
                                <div className="space-y-2 ltr-override text-lg text-center">
                                    <div className="text-slate-500 text-sm">住 砖 爪:</div>
                                    <div className="font-bold"><span className="text-red-600">{a}虏</span> + <span className="text-blue-600">{b}虏</span> = {a*a} + {b*b} = <span className="text-green-700 text-xl">{a*a + b*b}</span></div>
                                    <div className="text-slate-500 text-sm mt-2">专 转专 (砖专砖 砖):</div>
                                    <div className="font-bold text-green-700">c = {a*a + b*b} = <span className="bg-green-100 px-2 rounded">{c%1===0 ? c : c.toFixed(2)}</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- 砖转 转专 (Practice) ---
        const PracticeTab = () => {
            const [problem, setProblem] = useState(null);
            const [userAnswer, setUserAnswer] = useState('');
            const [feedback, setFeedback] = useState(null); 
            const [showSolution, setShowSolution] = useState(false);

            const generateProblem = () => {
                const types = ['find_c', 'find_a']; 
                const type = types[Math.floor(Math.random() * types.length)];
                
                const triples = [[3,4,5], [5,12,13], [8,15,17], [6,8,10], [9,12,15]];
                const triple = triples[Math.floor(Math.random() * triples.length)];
                const [leg1, leg2, hyp] = triple;

                if (type === 'find_c') {
                    setProblem({ type, a: leg1, b: leg2, answer: hyp, missing: 'c' });
                } else {
                    setProblem({ type, a: null, b: leg2, c: hyp, answer: leg1, missing: 'a' });
                }
                
                setUserAnswer('');
                setFeedback(null);
                setShowSolution(false);
            };

            useEffect(() => {
                generateProblem();
            }, []);

            const checkAnswer = () => {
                if (!problem) return;
                const val = parseFloat(userAnswer);
                if (Math.abs(val - problem.answer) < 0.1) {
                    setFeedback('correct');
                } else {
                    setFeedback('wrong');
                }
            };

            if (!problem) return <div>注...</div>;

            return (
                <div className="max-w-2xl mx-auto p-6 w-full h-full flex flex-col justify-center">
                    <div className="bg-white rounded-2xl shadow-lg border border-slate-200 overflow-hidden">
                        <div className="bg-slate-800 text-white p-4 text-center font-bold text-lg flex justify-between items-center">
                            <span>转专 砖</span>
                            <button onClick={generateProblem} className="bg-slate-700 p-2 rounded-full hover:bg-slate-600 transition"><RefreshIcon/></button>
                        </div>
                        
                        <div className="p-8 text-center">
                            <h3 className="text-xl font-bold text-slate-700 mb-6">
                                {problem.type === 'find_c' ? '爪 转 专 转专 (c)' : '爪 转 专 爪 住专 (a)'}
                            </h3>

                            <div className="flex justify-center mb-8">
                                <svg width="200" height="150" viewBox="0 0 200 150">
                                    <path d="M 40 120 L 40 20 L 160 120 Z" fill="rgba(241, 245, 249, 0.5)" stroke="#334155" strokeWidth="3" />
                                    <path d="M 40 105 L 55 105 L 55 120" fill="none" stroke="#334155" strokeWidth="2" />
                                    
                                    <text x="25" y="70" className="font-bold fill-red-600 font-mono text-lg">
                                        {problem.type === 'find_c' ? problem.a : '?'}
                                    </text>
                                    <text x="100" y="140" className="font-bold fill-blue-600 font-mono text-lg" textAnchor="middle">
                                        {problem.b}
                                    </text>
                                    <text x="110" y="60" className="font-bold fill-green-600 font-mono text-lg">
                                        {problem.type === 'find_c' ? '?' : problem.c}
                                    </text>
                                </svg>
                            </div>

                            <div className="flex gap-2 justify-center max-w-xs mx-auto mb-4">
                                <input 
                                    type="number" 
                                    value={userAnswer} 
                                    onChange={(e) => setUserAnswer(e.target.value)} 
                                    placeholder="转砖..."
                                    className="border-2 border-slate-300 rounded-lg p-3 w-full text-center text-xl font-bold focus:border-green-500 focus:outline-none"
                                />
                                <button onClick={checkAnswer} className="bg-green-600 text-white px-6 rounded-lg font-bold hover:bg-green-700 transition">
                                    <CheckIcon />
                                </button>
                            </div>

                            {feedback === 'correct' && (
                                <div className="bg-green-100 text-green-800 p-4 rounded-xl animate-bounce mb-4 font-bold">
                                     ! 转砖 ! 
                                </div>
                            )}

                            {feedback === 'wrong' && (
                                <div className="bg-red-50 text-red-800 p-4 rounded-xl mb-4">
                                     拽... 住 砖  爪爪 驻转专.
                                </div>
                            )}

                            <div className="text-center">
                                <button onClick={() => setShowSolution(!showSolution)} className="text-slate-500 underline text-sm hover:text-slate-700">
                                    {showSolution ? '住转专 驻转专' : '爪 专 驻转专'}
                                </button>
                            </div>

                            {showSolution && (
                                <div className="mt-4 bg-slate-50 p-4 rounded-xl text-right border border-slate-200 animate-fade-in ltr-override text-lg">
                                    {problem.type === 'find_c' ? (
                                        <>
                                            <p className="font-bold text-slate-700 mb-2 dir-rtl"> 爪 转专, 专 转 专注:</p>
                                            <p>c虏 = a虏 + b虏</p>
                                            <p>c虏 = {problem.a}虏 + {problem.b}虏</p>
                                            <p>c虏 = {problem.a**2} + {problem.b**2} = {problem.a**2 + problem.b**2}</p>
                                            <p className="font-bold text-green-600">c = {problem.a**2 + problem.b**2} = {problem.answer}</p>
                                        </>
                                    ) : (
                                        <>
                                            <p className="font-bold text-slate-700 mb-2 dir-rtl"> 爪 爪, 住专 转专:</p>
                                            <p>a虏 = c虏 - b虏</p>
                                            <p>a虏 = {problem.c}虏 - {problem.b}虏</p>
                                            <p>a虏 = {problem.c**2} - {problem.b**2} = {problem.c**2 - problem.b**2}</p>
                                            <p className="font-bold text-red-600">a = {problem.c**2 - problem.b**2} = {problem.answer}</p>
                                        </>
                                    )}
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // --- 驻拽爪 专砖转 ---
        const App = () => {
            const [activeTab, setActiveTab] = useState('explore');

            return (
                <div className="flex flex-col h-full">
                    {/* Header */}
                    <header className="bg-white border-b border-green-100 p-3 flex justify-between items-center shadow-sm shrink-0 z-20">
                        <div className="flex items-center gap-2">
                            <div className="bg-green-100 p-2 rounded-lg text-green-700">
                                <TriangleIcon />
                            </div>
                            <h1 className="font-bold text-xl text-green-900">砖驻 驻转专住</h1>
                        </div>
                        <div className="flex bg-green-50 p-1 rounded-lg">
                            <button 
                                onClick={() => setActiveTab('explore')}
                                className={`px-4 py-1.5 rounded-md text-sm font-bold transition-all flex items-center gap-2 ${activeTab === 'explore' ? 'bg-white text-green-700 shadow-sm' : 'text-green-600 hover:bg-green-100'}`}
                            >
                                <TriangleIcon className="w-4 h-4"/> 注
                            </button>
                            <button 
                                onClick={() => setActiveTab('practice')}
                                className={`px-4 py-1.5 rounded-md text-sm font-bold transition-all flex items-center gap-2 ${activeTab === 'practice' ? 'bg-white text-green-700 shadow-sm' : 'text-green-600 hover:bg-green-100'}`}
                            >
                                <CalculatorIcon className="w-4 h-4"/> 转专
                            </button>
                        </div>
                    </header>

                    {/* Content */}
                    <main className="flex-grow overflow-hidden relative bg-green-50/30">
                        {activeTab === 'explore' ? <ExploreTab /> : <PracticeTab />}
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>